<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Baum by etrepat</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Baum</h1>
        <h2>Baum is an implementation of the Nested Set pattern for Laravel 4's Eloquent ORM.</h2>
        <a href="https://github.com/etrepat/baum" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="baum" class="anchor" href="#baum"><span class="octicon octicon-link"></span></a>Baum</h1>

<p><a href="https://travis-ci.org/etrepat/baum"><img src="https://travis-ci.org/etrepat/baum.png?branch=master" alt="Build Status"></a></p>

<p>Baum is an implementation of the <a href="http://en.wikipedia.org/wiki/Nested_set_model">Nested Set</a>
pattern for <a href="http://laravel.com/">Laravel 4's</a> Eloquent ORM.</p>

<h2>
<a name="documentation" class="anchor" href="#documentation"><span class="octicon octicon-link"></span></a>Documentation</h2>

<ul>
<li><a href="#about">About Nested Sets</a></li>
<li><a href="#theory">The theory behind, a TL;DR version</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#getting-started">Getting started</a></li>
<li><a href="#usage">Usage</a></li>
</ul><p><a name="about"></a></p>

<h2>
<a name="about-nested-sets" class="anchor" href="#about-nested-sets"><span class="octicon octicon-link"></span></a>About Nested Sets</h2>

<p>A nested set is a smart way to implement an <em>ordered</em> tree that allows for fast,
non-recursive queries. For example, you can fetch all descendants of a node in a
single query, no matter how deep the tree. The drawback is that insertions/moves/deletes
require complex SQL, but that is handled behind the curtains by this package!</p>

<p>Nested sets are appropriate for ordered trees (e.g. menus, commercial categories)
and big trees that must be queried efficiently (e.g. threaded posts).</p>

<p>See the <a href="http://en.wikipedia.org/wiki/Nested_set_model">wikipedia entry for nested sets</a>
for more info. Also, this is a good introductory tutorial:
<a href="http://www.evanpetersen.com/item/nested-sets.html">http://www.evanpetersen.com/item/nested-sets.html</a></p>

<p><a name="theory"></a></p>

<h2>
<a name="the-theory-behind-a-tldr-version" class="anchor" href="#the-theory-behind-a-tldr-version"><span class="octicon octicon-link"></span></a>The theory behind, a TL;DR version</h2>

<p>An easy way to visualize how a nested set works is to think of a parent entity surrounding all
of its children, and its parent surrounding it, etc. So this tree:</p>

<pre><code>root
  |_ Child 1
    |_ Child 1.1
    |_ Child 1.2
  |_ Child 2
    |_ Child 2.1
    |_ Child 2.2
</code></pre>

<p>Could be visualized like this:</p>

<pre><code> ___________________________________________________________________
|  Root                                                             |
|    ____________________________    ____________________________   |
|   |  Child 1                  |   |  Child 2                  |   |
|   |   __________   _________  |   |   __________   _________  |   |
|   |  |  C 1.1  |  |  C 1.2 |  |   |  |  C 2.1  |  |  C 2.2 |  |   |
1   2  3_________4  5________6  7   8  9_________10 11_______12 13  14
|   |___________________________|   |___________________________|   |
|___________________________________________________________________|
</code></pre>

<p>The numbers represent the left and right boundaries.  The table then might
look like this:</p>

<pre><code>id | parent_id | lft  | rgt  | depth | data
 1 |           |    1 |   14 |     0 | root
 2 |         1 |    2 |    7 |     1 | Child 1
 3 |         2 |    3 |    4 |     2 | Child 1.1
 4 |         2 |    5 |    6 |     2 | Child 1.2
 5 |         1 |    8 |   13 |     1 | Child 2
 6 |         5 |    9 |   10 |     2 | Child 2.1
 7 |         5 |   11 |   12 |     2 | Child 2.2
</code></pre>

<p>To get all children of a <em>parent</em> node, you</p>

<div class="highlight highlight-sql"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">WHERE</span> <span class="n">lft</span> <span class="k">IS</span> <span class="k">BETWEEN</span> <span class="n">parent</span><span class="p">.</span><span class="n">lft</span> <span class="k">AND</span> <span class="n">parent</span><span class="p">.</span><span class="n">rgt</span>
</pre></div>

<p>To get the number of children, it's</p>

<div class="highlight highlight-sql"><pre><span class="p">(</span><span class="k">right</span> <span class="o">-</span> <span class="k">left</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</pre></div>

<p>To get a node and all its ancestors going back to the root, you</p>

<div class="highlight highlight-sql"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">WHERE</span> <span class="n">node</span><span class="p">.</span><span class="n">lft</span> <span class="k">IS</span> <span class="k">BETWEEN</span> <span class="n">lft</span> <span class="k">AND</span> <span class="n">rgt</span>
</pre></div>

<p>As you can see, queries that would be recursive and prohibitively slow on
ordinary trees are suddenly quite fast. Nifty, isn't it?</p>

<p><a name="installation"></a></p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Baum works with Laravel 4 onwards. You can add it to your <code>composer.json</code> file
with:</p>

<pre><code>"baum/baum": "~1.0"
</code></pre>

<p>Run <code>composer install</code> to install it.</p>

<p>As with most Laravel 4 packages you'll then need to register the Baum
<em>service provider</em>. To do that, head over your <code>app/config/app.php</code> file and add
the following line into the <code>providers</code> array:</p>

<pre><code>'Baum\BaumServiceProvider',
</code></pre>

<p><a name="getting-started"></a></p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting started</h2>

<p>After the package is correctly installed the easiest way to get started is to
run the provided generator:</p>

<pre><code>php artisan baum:install MODEL
</code></pre>

<p>Replace model by the class name you plan to use for your Nested Set model.</p>

<p>The generator will install a migration and a model file into your application
configured to work with the Nested Set behaviour provided by Baum. You SHOULD
take a look at those files, as each of them describes how they can be customized.</p>

<p>Next, you would probably run <code>artisan migrate</code> to apply the migration.</p>

<h3>
<a name="model-configuration" class="anchor" href="#model-configuration"><span class="octicon octicon-link"></span></a>Model configuration</h3>

<p>In order to work with Baum, you must ensure that your model class extends
<code>Baum\Node</code>.</p>

<p>This is the easiest it can get:</p>

<div class="highlight highlight-php"><pre><span class="k">class</span> <span class="nc">Category</span> <span class="k">extends</span> <span class="nx">Baum\Node</span> <span class="p">{</span>

<span class="p">}</span>
</pre></div>

<p>This is a <em>slightly</em> more complex example where we have the column names customized:</p>

<div class="highlight highlight-php"><pre><span class="k">class</span> <span class="nc">Dictionary</span> <span class="k">extends</span> <span class="nx">Baum\Node</span> <span class="p">{</span>

  <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">'dictionary'</span><span class="p">;</span>

  <span class="c1">// 'parent_id' column name</span>
  <span class="k">protected</span> <span class="nv">$parentColumn</span> <span class="o">=</span> <span class="s1">'parent_id'</span><span class="p">;</span>

  <span class="c1">// 'lft' column name</span>
  <span class="k">protected</span> <span class="nv">$leftColumn</span> <span class="o">=</span> <span class="s1">'lidx'</span><span class="p">;</span>

  <span class="c1">// 'rgt' column name</span>
  <span class="k">protected</span> <span class="nv">$rightColumn</span> <span class="o">=</span> <span class="s1">'ridx'</span><span class="p">;</span>

  <span class="c1">// 'depth' column name</span>
  <span class="k">protected</span> <span class="nv">$depthColumn</span> <span class="o">=</span> <span class="s1">'nesting'</span><span class="p">;</span>

  <span class="c1">// guard attributes from mass-assignment</span>
  <span class="k">protected</span> <span class="nv">$guarded</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'parent_id'</span><span class="p">,</span> <span class="s1">'lidx'</span><span class="p">,</span> <span class="s1">'ridx'</span><span class="p">,</span> <span class="s1">'nesting'</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>

<p>Remember that, obviously, the column names must match those in the database table.</p>

<h3>
<a name="migration-configuration" class="anchor" href="#migration-configuration"><span class="octicon octicon-link"></span></a>Migration configuration</h3>

<p>You must ensure that the database table that supports your Baum models has the
following columns:</p>

<ul>
<li>
<code>parent_id</code>: a reference to the parent (int)</li>
<li>
<code>lft</code>: left index bound (int)</li>
<li>
<code>rgt</code>: right index bound (int)</li>
<li>
<code>depth</code>: depth or nesting level (int)</li>
</ul><p>Here is a sample migration file:</p>

<div class="highlight highlight-php"><pre><span class="k">class</span> <span class="nc">Category</span> <span class="k">extends</span> <span class="nx">Migration</span> <span class="p">{</span>

  <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">'categories'</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">'id'</span><span class="p">);</span>

      <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">'parent_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
      <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">'lft'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
      <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">'rgt'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
      <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">'depth'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>

      <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>

      <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">Schema</span><span class="o">::</span><span class="na">drop</span><span class="p">(</span><span class="s1">'categories'</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>You may freely modify the column names, provided you change them both in the
migration and the model.</p>

<p><a name="usage"></a></p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>After you've configured your model and run the migration, you are now ready
to use Baum with your model. Below are some examples.</p>

<ul>
<li><a href="#creating-root-node">Creating a root node</a></li>
<li><a href="#inserting-nodes">Inserting nodes</a></li>
<li><a href="#deleting-nodes">Deleting nodes</a></li>
<li><a href="#node-level">Getting the nesting level of a node</a></li>
<li><a href="#moving-nodes">Moving nodes around</a></li>
<li><a href="#node-questions">Asking questions to your nodes</a></li>
<li><a href="#node-relations">Relations</a></li>
<li><a href="#node-basic-scopes">Root and Leaf scopes</a></li>
<li><a href="#node-chains">Accessing the ancestry/descendancy chain</a></li>
<li><a href="#node-model-events">Model events: <code>moving</code> and <code>moved</code></a></li>
<li><a href="#scope-support">Scope support</a></li>
<li><a href="#misc-utilities">Misc/Utility functions</a></li>
</ul><p><a name="creating-root-node"></a></p>

<h3>
<a name="creating-a-root-node" class="anchor" href="#creating-a-root-node"><span class="octicon octicon-link"></span></a>Creating a root node</h3>

<p>By default, all nodes are created as roots:</p>

<div class="highlight highlight-php"><pre><span class="nv">$root</span> <span class="o">=</span> <span class="nx">Category</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Root category'</span><span class="p">]);</span>
</pre></div>

<p>Alternatively, you may find yourself in the need of <em>converting</em> an existing node
into a <em>root node</em>:</p>

<div class="highlight highlight-php"><pre><span class="nv">$node</span><span class="o">-&gt;</span><span class="na">makeRoot</span><span class="p">();</span>
</pre></div>

<p><a name="inserting-nodes"></a></p>

<h3>
<a name="inserting-nodes" class="anchor" href="#inserting-nodes"><span class="octicon octicon-link"></span></a>Inserting nodes</h3>

<div class="highlight highlight-php"><pre><span class="c1">// Directly with a relation</span>
<span class="nv">$child1</span> <span class="o">=</span> <span class="nv">$root</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Child 1'</span><span class="p">]);</span>

<span class="c1">// with the `makeChildOf` method</span>
<span class="nv">$child2</span> <span class="o">=</span> <span class="nx">Category</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Child 2'</span><span class="p">]);</span>
<span class="nv">$child2</span><span class="o">-&gt;</span><span class="na">makeChildOf</span><span class="p">(</span><span class="nv">$root</span><span class="p">);</span>
</pre></div>

<p><a name="deleting-nodes"></a></p>

<h3>
<a name="deleting-nodes" class="anchor" href="#deleting-nodes"><span class="octicon octicon-link"></span></a>Deleting nodes</h3>

<div class="highlight highlight-php"><pre><span class="nv">$child1</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</pre></div>

<p>Descendants of deleted nodes will also be deleted and all the <code>lft</code> and <code>rgt</code>
bound will be recalculated. Pleases note that, for now, <code>deleting</code> and <code>deleted</code>
model events for the descendants will not be fired.</p>

<p><a name="node-level"></a></p>

<h3>
<a name="getting-the-nesting-level-of-a-node" class="anchor" href="#getting-the-nesting-level-of-a-node"><span class="octicon octicon-link"></span></a>Getting the nesting level of a node</h3>

<p>The <code>getLevel()</code> method will return current nesting level, or depth, of a node.</p>

<div class="highlight highlight-php"><pre><span class="nv">$node</span><span class="o">-&gt;</span><span class="na">getLevel</span><span class="p">()</span> <span class="c1">// 0 when root</span>
</pre></div>

<p><a name="moving-nodes"></a></p>

<h3>
<a name="moving-nodes-around" class="anchor" href="#moving-nodes-around"><span class="octicon octicon-link"></span></a>Moving nodes around</h3>

<p>Baum provides several methods for moving nodes around:</p>

<ul>
<li>
<code>moveLeft()</code>: Find the left sibling and move to the left of it.</li>
<li>
<code>moveRight()</code>: Find the right sibling and move to the right of it.</li>
<li>
<code>moveToLeftOf($otherNode)</code>: Move to the node to the left of ...</li>
<li>
<code>moveToRightOf($otherNode)</code>: Move to the node to the right of ...</li>
<li>
<code>makeNextSiblingOf($otherNode)</code>: Alias for <code>moveToRightOf</code>.</li>
<li>
<code>makeSiblingOf($otherNode)</code>: Alias for <code>makeNextSiblingOf</code>.</li>
<li>
<code>makePreviousSiblingOf($otherNode)</code>: Alias for <code>moveToLeftOf</code>.</li>
<li>
<code>makeChildOf($otherNode)</code>: Make the node a child of ...</li>
<li>
<code>makeRoot()</code>: Make current node a root node.</li>
</ul><p>For example:</p>

<div class="highlight highlight-php"><pre><span class="nv">$root</span> <span class="o">=</span> <span class="nx">Creatures</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'The Root of All Evil'</span><span class="p">]);</span>

<span class="nv">$dragons</span> <span class="o">=</span> <span class="nx">Creatures</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Here Be Dragons'</span><span class="p">]);</span>
<span class="nv">$dragons</span><span class="o">-&gt;</span><span class="na">makeChildOf</span><span class="p">(</span><span class="nv">$root</span><span class="p">);</span>

<span class="nv">$monsters</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Creatures</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Horrible Monsters'</span><span class="p">]);</span>
<span class="nv">$monsters</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

<span class="nv">$monsters</span><span class="o">-&gt;</span><span class="na">makeSiblingOf</span><span class="p">(</span><span class="nv">$dragons</span><span class="p">);</span>

<span class="nv">$demons</span> <span class="o">=</span> <span class="nx">Creatures</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">,</span> <span class="s1">'demons'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
<span class="nv">$demons</span><span class="o">-&gt;</span><span class="na">moveToLeftOf</span><span class="p">(</span><span class="nv">$dragons</span><span class="p">);</span>
</pre></div>

<p><a name="node-questions"></a></p>

<h3>
<a name="asking-questions-to-your-nodes" class="anchor" href="#asking-questions-to-your-nodes"><span class="octicon octicon-link"></span></a>Asking questions to your nodes</h3>

<p>You can ask some questions to your Baum nodes:</p>

<ul>
<li>
<code>isRoot()</code>: Returns true if this is a root node.</li>
<li>
<code>isLeaf()</code>: Returns true if this is a leaf node (end of a branch).</li>
<li>
<code>isChild()</code>: Returns true if this is a child node.</li>
<li>
<code>isDescendantOf($other)</code>: Returns true if node is a descendant of the other.</li>
<li>
<code>isSelfOrDescendantOf($other)</code>: Returns true if node is self or a descendant.</li>
<li>
<code>isAncestorOf($other)</code>: Returns true if node is an ancestor of the other.</li>
<li>
<code>isSelfOrAncestorOf($other)</code>: Returns true if node is self or an ancestor.</li>
<li>
<code>equals($node)</code>: current node instance equals the other.</li>
<li>
<code>insideSubtree($node)</code>: Checks wether the given node is inside the subtree
defined by the left and right indices.</li>
<li>
<code>inSameScope($node)</code>: Returns true if the given node is in the same scope
as the current one. That is, if <em>every</em> column in the <code>scoped</code> property has
the same value in both nodes.</li>
</ul><p>Using the nodes from the previous example:</p>

<div class="highlight highlight-php"><pre><span class="nv">$demons</span><span class="o">-&gt;</span><span class="na">isRoot</span><span class="p">();</span> <span class="c1">// =&gt; false</span>

<span class="nv">$demons</span><span class="o">-&gt;</span><span class="na">isDescendantOf</span><span class="p">(</span><span class="nv">$root</span><span class="p">)</span> <span class="c1">// =&gt; true</span>
</pre></div>

<p><a name="node-relations"></a></p>

<h3>
<a name="relations" class="anchor" href="#relations"><span class="octicon octicon-link"></span></a>Relations</h3>

<p>Baum provides two self-referential Eloquent relations for your nodes: <code>parent</code>
and <code>children</code>.</p>

<div class="highlight highlight-php"><pre><span class="nv">$parent</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">parent</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

<span class="nv">$children</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</pre></div>

<p><a name="node-basic-scopes"></a></p>

<h3>
<a name="root-and-leaf-scopes" class="anchor" href="#root-and-leaf-scopes"><span class="octicon octicon-link"></span></a>Root and Leaf scopes</h3>

<p>Baum provides some very basic query scopes for accessing the root and leaf nodes:</p>

<div class="highlight highlight-php"><pre><span class="c1">// Query scope which targets all root nodes</span>
<span class="nx">Category</span><span class="o">::</span><span class="na">roots</span><span class="p">()</span>

<span class="c1">// All leaf nodes (nodes at the end of a branch)</span>
<span class="nx">Category</span><span class="o">:</span><span class="nx">allLeaves</span><span class="p">()</span>
</pre></div>

<p>You may also be interested in only the first root:</p>

<div class="highlight highlight-php"><pre><span class="nv">$firstRootNode</span> <span class="o">=</span> <span class="nx">Category</span><span class="o">::</span><span class="na">root</span><span class="p">();</span>
</pre></div>

<p><a name="node-chains"></a></p>

<h3>
<a name="accessing-the-ancestrydescendancy-chain" class="anchor" href="#accessing-the-ancestrydescendancy-chain"><span class="octicon octicon-link"></span></a>Accessing the ancestry/descendancy chain</h3>

<p>There are several methods which Baum offers to access the ancestry/descendancy
chain of a node in the Nested Set tree. The main thing to keep in mind is that
they are provided in two ways:</p>

<p>First as <strong>query scopes</strong>, returning an <code>Illuminate\Database\Eloquent\Builder</code>
instance to continue to query further. To get <em>actual</em> results from these,
remember to call <code>get()</code> or <code>first()</code>.</p>

<ul>
<li>
<code>ancestorsAndSelf()</code>: Targets all the ancestor chain nodes including the current one.</li>
<li>
<code>ancestors()</code>: Query the ancestor chain nodes excluding the current one.</li>
<li>
<code>siblingsAndSelf()</code>: Instance scope which targets all children of the parent, including self.</li>
<li>
<code>siblings()</code>: Instance scope targeting all children of the parent, except self.</li>
<li>
<code>leaves()</code>: Instance scope targeting all of its nested children which do not have children.</li>
<li>
<code>descendantsAndSelf()</code>: Scope targeting itself and all of its nested children.</li>
<li>
<code>descendants()</code>: Set of all children &amp; nested children.</li>
<li>
<code>immediateDescendants()</code>: Set of all children nodes (non-recursive).</li>
</ul><p>Second, as <strong>methods</strong> which return actual <code>Baum\Node</code> instances (inside a <code>Collection</code>
object where appropiate):</p>

<ul>
<li>
<code>getRoot()</code>: Returns the root node starting at the current node.</li>
<li>
<code>getAncestorsAndSelf()</code>: Retrieve all of the ancestor chain including the current node.</li>
<li>
<code>getAncestorsAndSelfWithoutRoot()</code>: All ancestors (including the current node) except the root node.</li>
<li>
<code>getAncestors()</code>: Get all of the ancestor chain from the database excluding the current node.</li>
<li>
<code>getAncestorsWithoutRoot()</code>: All ancestors except the current node and the root node.</li>
<li>
<code>getSiblingsAndSelf()</code>: Get all children of the parent, including self.</li>
<li>
<code>getSiblings()</code>: Return all children of the parent, except self.</li>
<li>
<code>getLeaves()</code>: Return all of its nested children which do not have children.</li>
<li>
<code>getDescendantsAndSelf()</code>: Retrieve all nested children and self.</li>
<li>
<code>getDescendants()</code>: Retrieve all of its children &amp; nested children.</li>
<li>
<code>getImmediateDescendants()</code>: Retrieve all of its children nodes (non-recursive).</li>
</ul><p>Here's a simple example for iterating a node's descendants (provided a name
attribute is available):</p>

<div class="highlight highlight-php"><pre><span class="nv">$node</span> <span class="o">=</span> <span class="nx">Category</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">,</span> <span class="s1">'Books'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="na">getDescendantsAndSelf</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$descendant</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s2">"</span><span class="si">{</span><span class="nv">$descendant</span><span class="o">-&gt;</span><span class="na">name</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="node-model-events"></a></p>

<h3>
<a name="model-events-moving-and-moved" class="anchor" href="#model-events-moving-and-moved"><span class="octicon octicon-link"></span></a>Model events: <code>moving</code> and <code>moved</code>
</h3>

<p>Baum models fire the following events: <code>moving</code> and <code>moved</code> every time a node
is <em>moved</em> around the Nested Set tree. This allows you to hook into those points
in the node movement process. As with normal Eloquent model events, if <code>false</code>
is returned from the <code>moving</code> event, the movement operation will be cancelled.</p>

<p>The recommended way to hook into those events is by using the model's boot
method:</p>

<div class="highlight highlight-php"><pre><span class="k">class</span> <span class="nc">Category</span> <span class="k">extends</span> <span class="nx">Baum\Node</span> <span class="p">{</span>

  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">parent</span><span class="o">::</span><span class="na">boot</span><span class="p">();</span>

    <span class="k">static</span><span class="o">::</span><span class="na">moving</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Before moving the node this function will be called.</span>
    <span class="p">});</span>

    <span class="k">static</span><span class="o">::</span><span class="na">moved</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// After the move operation is processed this function will be</span>
      <span class="c1">// called.</span>
    <span class="p">});</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="scope-support"></a></p>

<h3>
<a name="scope-support" class="anchor" href="#scope-support"><span class="octicon octicon-link"></span></a>Scope support</h3>

<p>Baum provides a simple method to provide Nested Set "scoping" which restricts
what we consider part of a nested set tree. This should allow for multiple nested
set trees in the same database table.</p>

<p>To make use of the scoping funcionality you may override the <code>scoped</code> model
attribute in your subclass. This attribute should contain an array of the column
names (database fields) which shall be used to restrict Nested Set queries:</p>

<div class="highlight highlight-php"><pre><span class="k">class</span> <span class="nc">Category</span> <span class="k">extends</span> <span class="nx">Baum\Node</span> <span class="p">{</span>
  <span class="o">...</span>
  <span class="k">protected</span> <span class="nv">$scoped</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'company_id'</span><span class="p">);</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>

<p>In the previous example, <code>company_id</code> effectively restricts (or "scopes") a
Nested Set tree. So, for each value of that field we may be able to construct
a full different tree.</p>

<div class="highlight highlight-php"><pre><span class="nv">$root1</span> <span class="o">=</span> <span class="nx">Category</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'R1'</span><span class="p">,</span> <span class="s1">'company_id'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
<span class="nv">$root2</span> <span class="o">=</span> <span class="nx">Category</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'R2'</span><span class="p">,</span> <span class="s1">'company_id'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">]);</span>

<span class="nv">$child1</span> <span class="o">=</span> <span class="nx">Category</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'C1'</span><span class="p">,</span> <span class="s1">'company_id'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
<span class="nv">$child2</span> <span class="o">=</span> <span class="nx">Category</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'C2'</span><span class="p">,</span> <span class="s1">'company_id'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">]);</span>

<span class="nv">$child1</span><span class="o">-&gt;</span><span class="na">makeChildOf</span><span class="p">(</span><span class="nv">$root1</span><span class="p">);</span>
<span class="nv">$child2</span><span class="o">-&gt;</span><span class="na">makeChildOf</span><span class="p">(</span><span class="nv">$root2</span><span class="p">);</span>

<span class="nv">$root1</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span> <span class="c1">// &lt;- returns $child1</span>
<span class="nv">$root2</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span> <span class="c1">// &lt;- returns $child2</span>
</pre></div>

<p>All methods which ask or traverse the Nested Set tree will use the <code>scoped</code>
attribute (if provided).</p>

<p><a name="misc-utilities"></a></p>

<h3>
<a name="miscutility-functions" class="anchor" href="#miscutility-functions"><span class="octicon octicon-link"></span></a>Misc/Utility functions</h3>

<h4>
<a name="node-extraction-query-scopes" class="anchor" href="#node-extraction-query-scopes"><span class="octicon octicon-link"></span></a>Node extraction query scopes</h4>

<p>Baum provides some query scopes which may be used to extract (remove) selected nodes
from the current results set.</p>

<ul>
<li>
<code>withoutNode(node)</code>: Extracts the specified node from the current results set.</li>
<li>
<code>withoutSelf()</code>: Extracts itself from the current results set.</li>
<li>
<code>withoutRoot()</code>: Extracts the current root node from the results set.</li>
</ul><div class="highlight highlight-php"><pre><span class="nv">$node</span> <span class="o">=</span> <span class="nx">Category</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">,</span> <span class="s1">'Some category I do not want to see.'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>

<span class="nv">$root</span> <span class="o">=</span> <span class="nx">Category</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">,</span> <span class="s1">'Old boooks'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$root</span><span class="o">-&gt;</span><span class="na">descendantsAndSelf</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">withoutNode</span><span class="p">(</span><span class="nv">$node</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">());</span>
<span class="o">...</span> <span class="c1">// &lt;- This result set will not contain $node</span>
</pre></div>

<h2>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>TODO</h2>

<p>Some things I'm probably adding to this library (soonish, I hope):</p>

<ul>
<li>Rebuild from other implementations. You've got a current model &amp; table,
with only a <code>parent_id</code> id column? Shouldn't be a problem. Should it?</li>
</ul><h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>Thinking of contributing? Maybe you've found some nasty bug? That's great news!</p>

<ol>
<li>Fork the project:.</li>
<li>Create your bugfix/feature branch.</li>
<li>Commit your changes &amp; push to the branch.</li>
<li>Create new Pull Request</li>
</ol><h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>Baum is licensed under the terms of the <a href="http://opensource.org/licenses/MIT">MIT License</a>
(See LICENSE file for details).</p>

<hr><p>Coded by <a href="http://etrepat.com">Estanislau Trepat (etrepat)</a>. I'm also
<a href="http://twitter.com/etrepat">@etrepat</a> on twitter.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/etrepat/baum/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/etrepat/baum/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/etrepat/baum"></a> is maintained by <a href="https://github.com/etrepat">etrepat</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>